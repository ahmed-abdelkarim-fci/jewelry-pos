<div class="settings-container">
  <div class="settings-header">
    <h1><mat-icon>settings</mat-icon> {{ 'settings.title' | t }}</h1>
    <p class="subtitle">{{ 'settings.subtitle' | t }}</p>
  </div>

  <div class="settings-grid">
    <!-- Gold Rate Management -->
    <mat-card class="settings-card">
      <mat-card-header>
        <mat-card-title>
          <mat-icon>currency_exchange</mat-icon>
          {{ 'settings.gold.title' | t }}
        </mat-card-title>
      </mat-card-header>
      <mat-card-content>
        <form [formGroup]="goldRateForm" (ngSubmit)="updateGoldRates()">
          <div class="rate-grid">
            <mat-form-field appearance="outline">
              <mat-label>{{ 'settings.gold.k24Buy' | t }}</mat-label>
              <input matInput type="number" formControlName="karat24Buy" step="0.01">
              <mat-icon matPrefix>attach_money</mat-icon>
            </mat-form-field>

            <mat-form-field appearance="outline">
              <mat-label>{{ 'settings.gold.k24Sell' | t }}</mat-label>
              <input matInput type="number" formControlName="karat24Sell" step="0.01">
              <mat-icon matPrefix>sell</mat-icon>
            </mat-form-field>

            <mat-form-field appearance="outline">
              <mat-label>{{ 'settings.gold.k21Buy' | t }}</mat-label>
              <input matInput type="number" formControlName="karat21Buy" step="0.01">
              <mat-icon matPrefix>attach_money</mat-icon>
            </mat-form-field>

            <mat-form-field appearance="outline">
              <mat-label>{{ 'settings.gold.k21Sell' | t }}</mat-label>
              <input matInput type="number" formControlName="karat21Sell" step="0.01">
              <mat-icon matPrefix>sell</mat-icon>
            </mat-form-field>

            <mat-form-field appearance="outline">
              <mat-label>{{ 'settings.gold.k18Buy' | t }}</mat-label>
              <input matInput type="number" formControlName="karat18Buy" step="0.01">
              <mat-icon matPrefix>attach_money</mat-icon>
            </mat-form-field>

            <mat-form-field appearance="outline">
              <mat-label>{{ 'settings.gold.k18Sell' | t }}</mat-label>
              <input matInput type="number" formControlName="karat18Sell" step="0.01">
              <mat-icon matPrefix>sell</mat-icon>
            </mat-form-field>
          </div>

          <div class="form-actions">
            <button mat-raised-button color="primary" type="submit" [disabled]="goldRateForm.invalid || saving">
              <mat-icon>save</mat-icon>
              {{ saving ? ('settings.gold.saving' | t) : ('settings.gold.save' | t) }}
            </button>
          </div>
        </form>

        @if (lastUpdated) {
          <div class="last-updated">
            <mat-icon>schedule</mat-icon>
            {{ 'settings.gold.lastUpdated' | t }} {{ lastUpdated | date:'medium' }}
          </div>
        }
      </mat-card-content>
    </mat-card>

    <!-- Gold Rate History -->
    <mat-card class="settings-card">
      <mat-card-header>
        <mat-card-title>
          <mat-icon>history</mat-icon>
          {{ 'settings.history.title' | t }}
        </mat-card-title>
      </mat-card-header>
      <mat-card-content>
        <button mat-stroked-button (click)="toggleHistory()" class="toggle-history-btn">
          <mat-icon>{{ showHistory ? 'expand_less' : 'expand_more' }}</mat-icon>
          {{ showHistory ? ('settings.history.hide' | t) : ('settings.history.show' | t) }}
        </button>

        @if (showHistory) {
          @if (loadingHistory) {
            <div class="loading-container">
              <p>{{ 'settings.history.loading' | t }}</p>
            </div>
          } @else if (rateHistory.length > 0) {
            <div class="table-container">
              <table mat-table [dataSource]="rateHistory">
                <ng-container matColumnDef="effectiveDate">
                  <th mat-header-cell *matHeaderCellDef>{{ 'settings.history.date' | t }}</th>
                  <td mat-cell *matCellDef="let rate">{{ formatDate(rate.effectiveDate) }}</td>
                </ng-container>

                <ng-container matColumnDef="rate24k">
                  <th mat-header-cell *matHeaderCellDef>{{ 'settings.history.rate24' | t }}</th>
                  <td mat-cell *matCellDef="let rate">{{ rate.rate24k }} {{ 'unit.egpPerGramShort' | t }}</td>
                </ng-container>

                <ng-container matColumnDef="rate21k">
                  <th mat-header-cell *matHeaderCellDef>{{ 'settings.history.rate21' | t }}</th>
                  <td mat-cell *matCellDef="let rate">{{ rate.rate21k }} {{ 'unit.egpPerGramShort' | t }}</td>
                </ng-container>

                <ng-container matColumnDef="rate18k">
                  <th mat-header-cell *matHeaderCellDef>{{ 'settings.history.rate18' | t }}</th>
                  <td mat-cell *matCellDef="let rate">{{ rate.rate18k }} {{ 'unit.egpPerGramShort' | t }}</td>
                </ng-container>

                <tr mat-header-row *matHeaderRowDef="historyColumns"></tr>
                <tr mat-row *matRowDef="let row; columns: historyColumns;"></tr>
              </table>
            </div>

            <mat-paginator
              [length]="totalHistoryElements"
              [pageSize]="historyPageSize"
              [pageSizeOptions]="[5, 10, 20]"
              (page)="onHistoryPageChange($event)">
            </mat-paginator>
          } @else {
            <div class="empty-state">
              <mat-icon>inbox</mat-icon>
              <p>{{ 'settings.history.empty' | t }}</p>
            </div>
          }
        }
      </mat-card-content>
    </mat-card>

    <!-- System Configuration -->
    <mat-card class="settings-card">
      <mat-card-header>
        <mat-card-title>
          <mat-icon>toggle_on</mat-icon>
          {{ 'settings.system.title' | t }}
        </mat-card-title>
      </mat-card-header>
      <mat-card-content>
        @if (loadingConfig) {
          <div class="loading-config">{{ 'settings.system.loading' | t }}</div>
        } @else {
          <div class="toggle-row">
            <div class="toggle-info">
              <div class="toggle-title">{{ 'settings.system.goldAutoUpdate.title' | t }}</div>
              <div class="toggle-subtitle">{{ 'settings.system.goldAutoUpdate.subtitle' | t }}</div>
            </div>
            <mat-slide-toggle
              [checked]="goldAutoUpdateEnabled"
              (change)="onToggleGoldAutoUpdate($event.checked)">
            </mat-slide-toggle>
          </div>

          <div class="toggle-row">
            <div class="toggle-info">
              <div class="toggle-title">{{ 'settings.system.hardware.title' | t }}</div>
              <div class="toggle-subtitle">{{ 'settings.system.hardware.subtitle' | t }}</div>
            </div>
            <mat-slide-toggle
              [checked]="hardwareEnabled"
              (change)="onToggleHardware($event.checked)">
            </mat-slide-toggle>
          </div>
        }
      </mat-card-content>
    </mat-card>

    <!-- System Information -->
    <mat-card class="settings-card">
      <mat-card-header>
        <mat-card-title>
          <mat-icon>info</mat-icon>
          {{ 'settings.info.title' | t }}
        </mat-card-title>
      </mat-card-header>
      <mat-card-content>
        <div class="info-row">
          <span class="info-label">{{ 'settings.info.appName' | t }}</span>
          <span class="info-value">AL Mohamadia Jewelry POS</span>
        </div>
        <div class="info-row">
          <span class="info-label">{{ 'settings.info.version' | t }}</span>
          <span class="info-value">1.0.0</span>
        </div>
        <div class="info-row">
          <span class="info-label">{{ 'settings.info.db' | t }}</span>
          <span class="info-value">H2 In-Memory</span>
        </div>
        <div class="info-row">
          <span class="info-label">{{ 'settings.info.server' | t }}</span>
          <span class="info-value">Spring Boot 3.4.1</span>
        </div>
        <div class="info-row">
          <span class="info-label">{{ 'settings.info.frontend' | t }}</span>
          <span class="info-value">Angular 17+</span>
        </div>
      </mat-card-content>
    </mat-card>

    <!-- User Preferences -->
    <mat-card class="settings-card">
      <mat-card-header>
        <mat-card-title>
          <mat-icon>tune</mat-icon>
          {{ 'settings.prefs.title' | t }}
        </mat-card-title>
      </mat-card-header>
      <mat-card-content>
        <div class="preference-row">
          <mat-icon>language</mat-icon>
          <div class="preference-content">
            <div class="preference-label">{{ 'settings.prefs.language' | t }}</div>
            <div class="preference-value">{{ 'settings.prefs.languageValue' | t }}</div>
          </div>
        </div>
        <div class="preference-row">
          <mat-icon>currency_pound</mat-icon>
          <div class="preference-content">
            <div class="preference-label">{{ 'settings.prefs.currency' | t }}</div>
            <div class="preference-value">{{ 'settings.prefs.currencyValue' | t }}</div>
          </div>
        </div>
        <div class="preference-row">
          <mat-icon>scale</mat-icon>
          <div class="preference-content">
            <div class="preference-label">{{ 'settings.prefs.weightUnit' | t }}</div>
            <div class="preference-value">{{ 'settings.prefs.weightUnitValue' | t }}</div>
          </div>
        </div>
      </mat-card-content>
    </mat-card>
  </div>
</div>
